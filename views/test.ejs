<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" q type="text/css" href="../css/style.css">

<body>
    <h2 class="maintext" onclick="javascript:location.href='/main'" style="text-align:center;">
        세종시 자율주행 발렛 파킹
    </h2>

    <a href="javascript:void(0)" onclick="goBack()"><img
            src="https://cdn.pixabay.com/photo/2020/03/22/15/19/arrow-4957487_960_720.png" title="뒤로가기"
            class="m_back"></a>

    <script>
        function goBack() {
            window.history.back();
        }
    </script>

    <p class="button_onmain">발렛 파킹</p>

    <script>
        function btnActive() {
            const target = document.getElementById('target_btn');
            target.disabled = false;
        }

        function btnDisabled() {
            const target = document.getElementById('target_btn');
            target.disabled = true;
        }
    </script>

    <div id="map" style="width:auto;height:400px;"></div>

    <h2>
        <p span id="txtbox1" style="text-align:center;">파킹할 주차면을 선택해주세요</p>
    </h2>

    <div>
        <button class="styled1" type="button" id="parkingRequest">
            발렛 파킹 시작
        </button>
    </div>
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script type="text/javascript"
        src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=4oxbi73uru&callback=initMap"></script>
    <script type="text/javascript">
        
        
        var map = new naver.maps.Map('map', {
            center: new naver.maps.LatLng(36.498418, 127.28269),
            zoom: 18
        });

        var title = [];
        for (var k = 1; k < 11; k++) {
            title[k]=new naver.maps.Polygon();
        }

        var test_data = <%= data.length %>;
        console.log(test_data);

	var test_total = <%- JSON.stringify(data)%>;


        for (var j = 0; j < test_data; j++){            
            var temp = test_total[j];

            title[temp["slotid"]] = new naver.maps.Polygon({
                map: map,
                paths: [
                    [
                        new naver.maps.LatLng(temp["x1"], temp["y1"]),
                        new naver.maps.LatLng(temp["x2"], temp["y2"]),
                        new naver.maps.LatLng(temp["x3"], temp["y3"]),
                        new naver.maps.LatLng(temp["x4"], temp["y4"]),
                    ]
                ],
                fillColor: '#ff0000',
                fillOpacity: 0.3,
                strokeColor: '#ff0000',
                strokeOpacity: 0.6,
                strokeWeight: 3,
                clickable: true
            });
            naver.maps.Event.addListener(title[1], 'click', function (e) {
                mark(1, 36.4980100000, 127.2820850000);
            });
            naver.maps.Event.addListener(title[2], 'click', function (e) {
                mark(2, 36.4980990000, 127.2822950000);
            });
            naver.maps.Event.addListener(title[3], 'click', function (e) {
                mark(3, 36.4982330000, 127.2823620000);
            });
            naver.maps.Event.addListener(title[4], 'click', function (e) {
                mark(4, 36.4983890000, 127.2827250000);
            });
            naver.maps.Event.addListener(title[5], 'click', function (e) {
                mark(5, 36.4985820000, 127.2827220000);
            });

            naver.maps.Event.addListener(title[6], 'click', function (e) {
                mark(6, 36.4988660000, 127.2830730000);
            });

            naver.maps.Event.addListener(title[7], 'click', function (e) {
                mark(7, 36.4988170000, 127.2832540000);
            });

            naver.maps.Event.addListener(title[8], 'click', function (e) {
                mark(8, 36.4988190000, 127.2833570000);
            });
            naver.maps.Event.addListener(title[9], 'click', function (e) {
                mark(9, 36.4984460000, 127.2828930000);
            });
            naver.maps.Event.addListener(title[10], 'click', function (e) {
                mark(10, 36.4982000000, 127.2825900000);
            });
        }

        var marker_database =[];
        var slotid = 99999;
        var x1;
        var y1;

        function mark(id, x, y){
            if (marker_database.length==1){
                marker_database[0].setMap(null);
            }
            console.log(marker_database.length);
            var MarkerString = [
                '<span class="marker-title">' + slotid + '번' + '</span>' + '<span>주차면</span>'
            ].join('');

            var infowindow = new naver.maps.InfoWindow({
                content: MarkerString,
                // maxWidth: 180,
                backgroundColor: "#ffffff",
                borderColor: "#000",
                borderWidth: 0,
                // FontFace: 10,
                anchorSize: new naver.maps.Size(10, 10),
                // anchorSkew: false,
                // anchorColor: "#eee",
    
            });

            infowindow.close()
            var marker = new naver.maps.Marker({
                map: map,
                //title: locations[i].place,
                position: new naver.maps.LatLng(x, y),
            });
            marker_database[0] = marker;
            console.log(marker_database);
            infowindow.open(map, marker)

            // 클릭시 이벤트 발생                                     
            naver.maps.Event.addListener(marker, 'click', function (e) {
                if (infowindow.getMap()) {
                    infowindow.close();
                } else {
                    console.log(MarkerString)
                    infowindow.open(map, marker)
                }
            });
            document.getElementById("txtbox1").innerText = '세종특별시 수목원로 129 주차장\n' +slotid+'번 주차면';
            slotid = id;
            x1 = x;
            y1 = y;
            
        }

        $("#parkingRequest").click(function () {
            if (<%= slotcheck %> == 1){
                if (slotid<11){
                    $.ajax({
                        url: '/parking/Request',
                        type: 'POST',
                        data: {slot: slotid, car:<%=carid %>}
                    });
                    location.href = "/parking2?x1=" +x1+"&y1=" +y1+"&cid=" +<%=carid %>+"&slotid="+slotid;
                } else {
                    swal({
                        title: "주차면을 선택해주세요.",
                        icon: "error",
                        button: "확인",
                    });
                }
            } else {
                swal({
                    title: "빈자리가 없습니다.",
                    icon: "error",
                    button: "확인",
                });
            }
        });
    </script>

    <!-- <script>
        var x1 = 36.498922;
        var y1 = 127.281995;
        var position = new naver.maps.LatLng(x1, y1);
        var markerOptions = {
            position: position,
            map: map,
            icon: {
                url: '../images/parking.png',
                size: new naver.maps.Size(70, 70),
                origin: new naver.maps.Point(0, 0),
                anchor: new naver.maps.Point(25, 26)
            }
        };

        var marker_1 = new naver.maps.Marker(markerOptions);
    </script>

    <script>
        var x2 = 36.497801;
        var y2 = 127.283394;
        var position1 = new naver.maps.LatLng(x2, y2);
        var markerOptions = {
            position: position1,
            map: map,
            icon: {
                url: '../images/parking.png',
                size: new naver.maps.Size(70, 70),
                origin: new naver.maps.Point(0, 0),
                anchor: new naver.maps.Point(25, 26)
            }
        };
        var marker_2 = new naver.maps.Marker(markerOptions);
    </script>

<script>
    var x2 = 36.4989;
    var y2 = 127.2849;
    var position1 = new naver.maps.LatLng(x2, y2);
    var markerOptions = {
        position: position1,
        map: map,
        icon: {
            url: '../images/parking.png',
            size: new naver.maps.Size(70, 70),
            origin: new naver.maps.Point(0, 0),
            anchor: new naver.maps.Point(25, 26)
        }
    };
    var marker_3 = new naver.maps.Marker(markerOptions);
</script> -->
        <!-- <script>
        
            naver.maps.Event.addListener(marker_1, 'click', function () {
                console.log("1 click");
                loc_check = 1;
                loc_data = 1;
                alert("위치가 선택되었습니다.");
                document.getElementById("txtbox1").innerText = '세종특별시 수목원로 120 하차지점'
    
            });
            function ViewLayer(){
            document.getElementById("Pop").style.display='inline'
         }
            naver.maps.Event.addListener(marker_2, 'click', function () {
                console.log("2 click");
                loc_check = 1;
                loc_data = 2;
                alert("위치가 선택되었습니다.");
                document.getElementById("txtbox1").innerText = '세종특별시 수목원로 131 하차지점'
    
            });

            naver.maps.Event.addListener(marker_3, 'click', function () {
                console.log("2 click");
                loc_check = 1;
                loc_data = 2;
                alert("위치가 선택되었습니다.");
                document.getElementById("txtbox1").innerText = '세종특별시 수목원로 129 주차장'
    
            });
        </script> -->
    <div>
</body>

</html>

